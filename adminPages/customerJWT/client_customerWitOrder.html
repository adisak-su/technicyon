<!DOCTYPE html>
<html lang="th">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ระบบข้อมูลลูกค้าและประวัติการซื้อ</title>
        <!-- Bootstrap v4 -->
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
        />
        <!-- Font Awesome -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        />
        <!-- SweetAlert2 -->
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.css"
        />
        <style>
            :root {
                --primary: #3498db;
                --secondary: #2c3e50;
                --success: #2ecc71;
                --danger: #e74c3c;
                --warning: #f39c12;
                --info: #1abc9c;
                --sidebar: #2c3e50;
                --sidebar-hover: #34495e;
                --sidebar-hover: linear-gradient(
                    135deg,
                    var(--success) 0%,
                    var(--secondary) 100%
                );
                --sidebar-active: #3498db;
            }

            body {
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
                min-height: 100vh;
                font-family: "Kanit", sans-serif;
            }

            .header {
                background: linear-gradient(
                    135deg,
                    var(--primary) 0%,
                    var(--secondary) 100%
                );
                color: white;
                padding: 20px 0;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                position: sticky;
                top: 0;
                z-index: 1000;
            }

            /* Slide Menu Styles */
            #sidebar {
                min-width: 250px;
                max-width: 250px;
                background: var(--sidebar);
                color: #fff;
                background: linear-gradient(
                    135deg,
                    var(--primary) 0%,
                    var(--secondary) 100%
                );
                color: white;

                transition: all 0.3s;
                position: fixed;
                height: 100vh;
                z-index: 1000;
                box-shadow: 3px 0 10px rgba(0, 0, 0, 0.1);
            }

            #sidebar.active {
                margin-left: -250px;
            }

            #sidebar .sidebar-header {
                padding: 20px;
                background: rgba(0, 0, 0, 0.2);
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            #sidebar .sidebar-header h3 {
                font-size: 1.5rem;
                font-weight: 600;
                margin-bottom: 0;
            }

            #sidebar ul.components {
                padding: 20px 0;
            }

            #sidebar ul li a {
                padding: 15px 20px;
                font-size: 1.1em;
                display: block;
                color: rgba(255, 255, 255, 0.8);
                text-decoration: none;
                transition: all 0.3s;
                border-left: 4px solid transparent;
            }

            #sidebar ul li a:hover {
                color: #fff;
                background: var(--sidebar-hover);
                border-left: 4px solid var(--sidebar-active);
                color: white;
            }

            #sidebar ul li a i {
                margin-right: 10px;
                min-width: 20px;
                text-align: center;
            }

            #sidebar ul li.active > a {
                color: #fff;
                background: var(--sidebar-hover);
                border-left: 4px solid var(--sidebar-active);
                color: white;
            }

            #sidebar .sidebar-footer {
                position: absolute;
                bottom: 0;
                width: 100%;
                padding: 15px;
                background: rgba(0, 0, 0, 0.2);
                text-align: center;
                font-size: 0.9rem;
                color: rgba(255, 255, 255, 0.6);
            }

            /* Content Styles */
            #content {
                width: calc(100% - 250px);
                min-height: 100vh;
                transition: all 0.3s;
                position: absolute;
                top: 0;
                right: 0;
            }

            #content.active {
                width: 100%;
            }

            /* Main Content Styles */
            .main-content {
                padding: 30px;
            }

            .tab-content {
                padding: 30px;
            }

            /* Responsive Styles */
            @media (max-width: 768px) {
                #sidebar {
                    margin-left: -250px;
                }

                #sidebar.active {
                    margin-left: 0;
                }

                #content {
                    width: 100%;
                }

                #content.active {
                    width: calc(100% - 250px);
                }
            }

            /* Navbar Styles */
            .top-navbar {
                background: #fff;
                padding: 15px 20px;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
                z-index: 900;
            }

            .menu-toggle-btn {
                background: none;
                border: none;
                font-size: 1.5rem;
                color: var(--secondary);
                cursor: pointer;
            }

            .customer-container {
                max-width: 1200px;
                margin: 30px auto;
                padding: 20px;
            }

            .customer-card {
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
                overflow: hidden;
                margin-bottom: 30px;
            }

            .customer-header {
                background: linear-gradient(
                    135deg,
                    var(--info) 0%,
                    #16a085 100%
                );
                padding: 25px 30px;
                color: white;
                display: flex;
                align-items: center;
            }

            .customer-avatar {
                width: 100px;
                height: 100px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.2);
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 2.5rem;
                margin-right: 20px;
                border: 3px solid white;
            }

            .customer-info {
                flex: 1;
            }

            .customer-name {
                font-size: 1.8rem;
                font-weight: 600;
                margin-bottom: 5px;
            }

            .customer-id {
                font-size: 1.1rem;
                opacity: 0.9;
                background: rgba(0, 0, 0, 0.1);
                padding: 3px 10px;
                border-radius: 20px;
                display: inline-block;
            }

            .tabs-container {
                background: white;
                border-radius: 15px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
                overflow: hidden;
            }

            .nav-tabs {
                background: var(--secondary);
                padding: 0 20px;
                border: none;
            }

            .nav-item {
                margin: 0;
            }

            .nav-link {
                color: rgba(255, 255, 255, 0.7) !important;
                border: none !important;
                border-radius: 0 !important;
                padding: 15px 25px !important;
                font-weight: 500;
                transition: all 0.3s;
                position: relative;
            }

            .nav-link.active {
                color: white !important;
                background: transparent !important;
            }

            .nav-link.active:after {
                content: "";
                position: absolute;
                bottom: 0;
                left: 0;
                width: 100%;
                height: 3px;
                background: var(--primary);
            }

            .nav-link:hover {
                color: white !important;
                background: rgba(255, 255, 255, 0.1) !important;
            }

            .tab-content {
                padding: 30px;
            }

            .info-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
            }

            .info-card {
                background: #f8f9fa;
                border-radius: 10px;
                padding: 20px;
                border-left: 4px solid var(--info);
            }

            .info-card h5 {
                color: var(--secondary);
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            }

            .info-item {
                display: flex;
                margin-bottom: 12px;
            }

            .info-label {
                flex: 0 0 120px;
                color: #6c757d;
                font-weight: 500;
            }

            .info-value {
                flex: 1;
                font-weight: 500;
            }

            .table-container {
                overflow: hidden;
                border-radius: 10px;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
            }

            .table thead th {
                background: var(--primary);
                color: white;
                border: none;
                padding: 15px 20px;
            }

            .table tbody td {
                padding: 12px 20px;
                vertical-align: middle;
            }

            .table tbody tr {
                transition: background 0.2s;
            }

            .table tbody tr:hover {
                background: rgba(52, 152, 219, 0.03);
            }

            .status-badge {
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 500;
            }

            .status-completed {
                background: rgba(46, 204, 113, 0.15);
                color: var(--success);
            }

            .status-pending {
                background: rgba(243, 156, 18, 0.15);
                color: var(--warning);
            }

            .status-cancelled {
                background: rgba(231, 76, 60, 0.15);
                color: var(--danger);
            }

            .btn-action {
                border-radius: 50px;
                padding: 8px 20px;
                font-weight: 500;
                transition: all 0.3s;
            }

            .btn-refresh {
                background: linear-gradient(to right, var(--success), #27ae60);
                border: none;
                color: white;
            }

            .btn-refresh:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
            }

            .btn-logout {
                background: linear-gradient(to right, var(--danger), #c0392b);
                border: none;
                color: white;
            }

            .btn-logout:hover {
                transform: translateY(-3px);
                box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
            }

            .stats-container {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
                margin-bottom: 25px;
            }

            .stat-card {
                background: white;
                border-radius: 10px;
                padding: 20px;
                text-align: center;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
                transition: transform 0.3s;
            }

            .stat-card:hover {
                transform: translateY(-5px);
            }

            .stat-icon {
                font-size: 2rem;
                color: var(--primary);
                margin-bottom: 15px;
            }

            .stat-value {
                font-size: 1.8rem;
                font-weight: 700;
                margin-bottom: 5px;
            }

            .stat-label {
                color: #6c757d;
                font-size: 0.95rem;
            }

            .loading-container {
                display: flex;
                justify-content: center;
                align-items: center;
                min-height: 300px;
                flex-direction: column;
            }

            .spinner {
                width: 4rem;
                height: 4rem;
                border: 0.35em solid rgba(52, 152, 219, 0.2);
                border-top-color: var(--primary);
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-bottom: 20px;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .purchase-details {
                background: #f8f9fa;
                border-radius: 10px;
                padding: 20px;
                margin-top: 20px;
                border-left: 4px solid var(--primary);
            }

            .detail-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .detail-item {
                margin-bottom: 10px;
            }

            .detail-label {
                color: #6c757d;
                font-weight: 500;
                margin-bottom: 5px;
            }

            .detail-value {
                font-weight: 500;
                font-size: 1.1rem;
            }
            #sidebar {
                margin-left: -250px;
            }

            #sidebar.active {
                margin-left: 0;
            }

            #content {
                width: 100%;
            }

            #content.active {
                width: calc(100% - 250px);
            }
        </style>
    </head>
    <body>
        <!-- Slide Menu -->
        <nav id="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-store"></i> ระบบขายสินค้า</h3>
            </div>

            <ul class="list-unstyled components">
                <li>
                    <a href="#"
                        ><i class="fas fa-tachometer-alt"></i> ภาพรวมระบบ</a
                    >
                </li>
                <li class="active">
                    <a href="#"><i class="fas fa-user-tag"></i> ข้อมูลลูกค้า</a>
                </li>
                <li>
                    <a href="#"
                        ><i class="fas fa-shopping-cart"></i> การสั่งซื้อ</a
                    >
                </li>
                <li>
                    <a href="#"><i class="fas fa-box"></i> สินค้า</a>
                </li>
                <li>
                    <a href="#"><i class="fas fa-chart-bar"></i> รายงาน</a>
                </li>
                <li>
                    <a href="#"><i class="fas fa-users"></i> ผู้ใช้งาน</a>
                </li>
                <li>
                    <a href="#"><i class="fas fa-cog"></i> การตั้งค่า</a>
                </li>
                <li>
                    <a href="#"
                        ><i class="fas fa-question-circle"></i> ช่วยเหลือ</a
                    >
                </li>
            </ul>

            <div class="sidebar-footer">
                ระบบจัดการข้อมูลลูกค้า<br />เวอร์ชั่น 2.0
            </div>
        </nav>

        <div id="content">
            <!-- Top Navbar -->
            <nav class="top-navbar">
                <div>
                    <button class="menu-toggle-btn" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <span
                        style="
                            margin-left: 20px;
                            font-weight: 500;
                            color: var(--secondary);
                        "
                        >ข้อมูลลูกค้าและประวัติการซื้อ</span
                    >
                </div>

                <div class="user-controls">
                    <div class="user-info">
                        <div class="user-avatar">AD</div>
                        <div>
                            <div>ผู้ดูแลระบบ</div>
                            <small>Admin</small>
                        </div>
                    </div>
                    <button
                        class="btn btn-sm btn-outline-danger"
                        id="logoutBtn"
                    >
                        <i class="fas fa-sign-out-alt"></i> ออกจากระบบ
                    </button>
                </div>
            </nav>

            <!-- Main Content -->
            <div class="main-content">
                <header class="header">
                    <div class="container">
                        <div
                            class="d-flex justify-content-between align-items-center"
                        >
                            <h1>
                                <i class="fas fa-user-tag"></i>
                                ระบบข้อมูลลูกค้าและประวัติการซื้อ
                            </h1>
                            <div>
                                <button
                                    id="refreshBtn"
                                    class="btn btn-action btn-refresh mr-2"
                                >
                                    <i class="fas fa-sync-alt"></i>
                                    โหลดข้อมูลใหม่
                                </button>
                                <button
                                    id="logoutBtn"
                                    class="btn btn-action btn-logout"
                                >
                                    <i class="fas fa-sign-out-alt"></i>
                                    ออกจากระบบ
                                </button>
                            </div>
                        </div>
                    </div>
                </header>

                <div class="container customer-container">
                    <!-- ส่วนข้อมูลลูกค้า -->
                    <div class="customer-card">
                        <div class="customer-header">
                            <div class="customer-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                            <div class="customer-info">
                                <div class="customer-name" id="customerName">
                                    กำลังโหลดข้อมูล...
                                </div>
                                <div class="customer-id">
                                    รหัสลูกค้า: <span id="customerId">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="tabs-container">
                            <!-- แท็บเมนู -->
                            <ul
                                class="nav nav-tabs"
                                id="customerTabs"
                                role="tablist"
                            >
                                <li class="nav-item">
                                    <a
                                        class="nav-link active"
                                        id="info-tab"
                                        data-toggle="tab"
                                        href="#info"
                                        role="tab"
                                    >
                                        <i class="fas fa-info-circle mr-2"></i
                                        >ข้อมูลลูกค้า
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a
                                        class="nav-link"
                                        id="purchases-tab"
                                        data-toggle="tab"
                                        href="#purchases"
                                        role="tab"
                                    >
                                        <i class="fas fa-shopping-cart mr-2"></i
                                        >ประวัติการซื้อ
                                    </a>
                                </li>
                            </ul>

                            <!-- เนื้อหาแท็บ -->
                            <div class="tab-content" id="customerTabsContent">
                                <!-- แท็บข้อมูลลูกค้า -->
                                <div
                                    class="tab-pane fade show active"
                                    id="info"
                                    role="tabpanel"
                                >
                                    <div
                                        id="customerInfoLoading"
                                        class="loading-container"
                                    >
                                        <div class="spinner"></div>
                                        <p>กำลังโหลดข้อมูลลูกค้า...</p>
                                    </div>

                                    <div
                                        id="customerInfoContent"
                                        style="display: none"
                                    >
                                        <div class="stats-container">
                                            <div class="stat-card">
                                                <div class="stat-icon">
                                                    <i
                                                        class="fas fa-shopping-bag"
                                                    ></i>
                                                </div>
                                                <div
                                                    class="stat-value"
                                                    id="totalPurchases"
                                                >
                                                    0
                                                </div>
                                                <div class="stat-label">
                                                    จำนวนการซื้อทั้งหมด
                                                </div>
                                            </div>

                                            <div class="stat-card">
                                                <div class="stat-icon">
                                                    <i
                                                        class="fas fa-money-bill-wave"
                                                    ></i>
                                                </div>
                                                <div
                                                    class="stat-value"
                                                    id="totalSpent"
                                                >
                                                    0
                                                </div>
                                                <div class="stat-label">
                                                    ยอดซื้อทั้งหมด
                                                </div>
                                            </div>

                                            <div class="stat-card">
                                                <div class="stat-icon">
                                                    <i
                                                        class="fas fa-calendar-check"
                                                    ></i>
                                                </div>
                                                <div
                                                    class="stat-value"
                                                    id="lastPurchase"
                                                >
                                                    -
                                                </div>
                                                <div class="stat-label">
                                                    การซื้อล่าสุด
                                                </div>
                                            </div>

                                            <div class="stat-card">
                                                <div class="stat-icon">
                                                    <i class="fas fa-star"></i>
                                                </div>
                                                <div
                                                    class="stat-value"
                                                    id="customerLevel"
                                                >
                                                    -
                                                </div>
                                                <div class="stat-label">
                                                    ระดับลูกค้า
                                                </div>
                                            </div>
                                        </div>

                                        <div class="info-grid">
                                            <div class="info-card">
                                                <h5>
                                                    <i
                                                        class="fas fa-address-card mr-2"
                                                    ></i
                                                    >ข้อมูลส่วนตัว
                                                </h5>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        ชื่อ-สกุล:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerFullName"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        เพศ:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerGender"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        วันเกิด:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerDob"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        อายุ:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerAge"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="info-card">
                                                <h5>
                                                    <i
                                                        class="fas fa-address-book mr-2"
                                                    ></i
                                                    >ข้อมูลติดต่อ
                                                </h5>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        อีเมล:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerEmail"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        โทรศัพท์:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerPhone"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        ที่อยู่:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerAddress"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="info-card">
                                                <h5>
                                                    <i
                                                        class="fas fa-chart-line mr-2"
                                                    ></i
                                                    >ข้อมูลลูกค้า
                                                </h5>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        วันที่สมัคร:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="joinDate"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        ประเภทลูกค้า:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerType"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        คะแนนสะสม:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerPoints"
                                                    >
                                                        0
                                                    </div>
                                                </div>
                                                <div class="info-item">
                                                    <div class="info-label">
                                                        สถานะ:
                                                    </div>
                                                    <div
                                                        class="info-value"
                                                        id="customerStatus"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- แท็บประวัติการซื้อ -->
                                <div
                                    class="tab-pane fade"
                                    id="purchases"
                                    role="tabpanel"
                                >
                                    <div
                                        id="purchasesLoading"
                                        class="loading-container"
                                    >
                                        <div class="spinner"></div>
                                        <p>กำลังโหลดประวัติการซื้อ...</p>
                                    </div>

                                    <div
                                        id="purchasesContent"
                                        style="display: none"
                                    >
                                        <div class="table-container">
                                            <table class="table table-hover">
                                                <thead>
                                                    <tr>
                                                        <th>รหัสคำสั่งซื้อ</th>
                                                        <th>วันที่</th>
                                                        <th>จำนวน</th>
                                                        <th>ยอดรวม</th>
                                                        <th>ช่องทางการชำระ</th>
                                                        <th>สถานะ</th>
                                                        <th>การดำเนินการ</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="purchasesTableBody">
                                                    <!-- ข้อมูลจะถูกเพิ่มโดย JavaScript -->
                                                </tbody>
                                            </table>
                                        </div>

                                        <div
                                            id="purchaseDetails"
                                            class="purchase-details"
                                            style="display: none"
                                        >
                                            <h5>
                                                <i
                                                    class="fas fa-receipt mr-2"
                                                ></i
                                                >รายละเอียดคำสั่งซื้อ:
                                                <span id="orderId"></span>
                                            </h5>

                                            <div class="detail-grid">
                                                <div class="detail-item">
                                                    <div class="detail-label">
                                                        วันที่สั่งซื้อ
                                                    </div>
                                                    <div
                                                        class="detail-value"
                                                        id="orderDate"
                                                    >
                                                        -
                                                    </div>
                                                </div>

                                                <div class="detail-item">
                                                    <div class="detail-label">
                                                        ยอดรวม
                                                    </div>
                                                    <div
                                                        class="detail-value"
                                                        id="orderTotal"
                                                    >
                                                        -
                                                    </div>
                                                </div>

                                                <div class="detail-item">
                                                    <div class="detail-label">
                                                        ช่องทางการชำระ
                                                    </div>
                                                    <div
                                                        class="detail-value"
                                                        id="orderPayment"
                                                    >
                                                        -
                                                    </div>
                                                </div>

                                                <div class="detail-item">
                                                    <div class="detail-label">
                                                        สถานะ
                                                    </div>
                                                    <div
                                                        class="detail-value"
                                                        id="orderStatus"
                                                    >
                                                        -
                                                    </div>
                                                </div>
                                            </div>

                                            <h6 class="mt-4 mb-3">
                                                <i
                                                    class="fas fa-box-open mr-2"
                                                ></i
                                                >รายการสินค้า
                                            </h6>
                                            <div class="table-responsive">
                                                <table class="table table-sm">
                                                    <thead class="bg-light">
                                                        <tr>
                                                            <th>สินค้า</th>
                                                            <th>ราคา</th>
                                                            <th>จำนวน</th>
                                                            <th>รวม</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="orderItemsBody">
                                                        <!-- ข้อมูลจะถูกเพิ่มโดย JavaScript -->
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- SweetAlert2 -->
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.js"></script>
        <!-- Axios -->
        <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
        <!-- jQuery and Bootstrap -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            // ตัวแปรเก็บข้อมูล
            let customerData = null;
            let purchaseData = null;

            $(document).ready(function () {
                $("#sidebarToggle").click(function (e) {
                    e.stopPropagation();
                    $("#sidebar").toggleClass("active");
                    $("#content").toggleClass("active");
                });
                $("#content").click(function (e) {
                    if ($("#sidebar").hasClass("active")) {
                        $("#sidebar").removeClass("active");
                        $("#content").removeClass("active");
                    }
                });

                // Prevent closing when clicking inside sidebar
                $("#sidebar").click(function (e) {
                    e.stopPropagation();
                });
            });

            // ฟังก์ชันเริ่มต้น
            document.addEventListener("DOMContentLoaded", function () {
                const token = localStorage.getItem("jwtToken");
                if (!token) {
                    showErrorAndRedirect(
                        "ยังไม่ได้ล็อกอิน",
                        "กรุณาล็อกอินก่อนเข้าถึงหน้านี้"
                    );
                    return;
                }

                // โหลดข้อมูลลูกค้า
                fetchCustomerData();

                // เพิ่ม event listeners
                document
                    .getElementById("refreshBtn")
                    .addEventListener("click", function () {
                        fetchCustomerData();
                        if ($("#purchases-tab").hasClass("active")) {
                            fetchPurchaseData();
                        }
                    });

                document
                    .getElementById("logoutBtn")
                    .addEventListener("click", logout);

                // เมื่อเปลี่ยนแท็บ
                $("#purchases-tab").on("shown.bs.tab", function () {
                    if (!purchaseData) {
                        fetchPurchaseData();
                    }
                });
            });

            // ดึงข้อมูลลูกค้า
            async function fetchCustomerData() {
                const token = localStorage.getItem("jwtToken");
                if (!token) return;

                // แสดง loading
                document.getElementById("customerInfoLoading").style.display =
                    "flex";
                document.getElementById("customerInfoContent").style.display =
                    "none";

                try {
                    const response = await axios.get("api/customer.php", {
                        headers: {
                            Authorization: `Bearer ${token}`,
                        },
                    });

                    if (response.data.status === "success") {
                        customerData = response.data.customer;
                        renderCustomerData();
                    } else {
                        throw new Error(response.data.message);
                    }
                } catch (error) {
                    handleApiError(error, "fetchCustomerData");
                }
            }

            // แสดงข้อมูลลูกค้า
            function renderCustomerData() {
                document.getElementById("customerId").textContent =
                    customerData.id;
                document.getElementById("customerName").textContent =
                    customerData.name;
                document.getElementById("customerFullName").textContent =
                    customerData.full_name;
                document.getElementById("customerGender").textContent =
                    customerData.gender;
                document.getElementById("customerDob").textContent =
                    customerData.dob;
                document.getElementById("customerAge").textContent =
                    customerData.age + " ปี";
                document.getElementById("customerEmail").textContent =
                    customerData.email;
                document.getElementById("customerPhone").textContent =
                    customerData.phone;
                document.getElementById("customerAddress").textContent =
                    customerData.address;
                document.getElementById("joinDate").textContent =
                    customerData.join_date;
                document.getElementById("customerType").textContent =
                    customerData.type;
                document.getElementById("customerPoints").textContent =
                    customerData.points.toLocaleString();
                document.getElementById("customerStatus").textContent =
                    customerData.status;
                document.getElementById("totalPurchases").textContent =
                    customerData.total_purchases;
                document.getElementById("totalSpent").textContent =
                    "฿" + customerData.total_spent.toLocaleString();
                document.getElementById("lastPurchase").textContent =
                    customerData.last_purchase || "-";
                document.getElementById("customerLevel").textContent =
                    customerData.level;

                // ซ่อน loading และแสดงข้อมูล
                document.getElementById("customerInfoLoading").style.display =
                    "none";
                document.getElementById("customerInfoContent").style.display =
                    "block";
            }

            // ดึงข้อมูลประวัติการซื้อ
            async function fetchPurchaseData() {
                const token = localStorage.getItem("jwtToken");
                if (!token) return;

                // แสดง loading
                document.getElementById("purchasesLoading").style.display =
                    "flex";
                document.getElementById("purchasesContent").style.display =
                    "none";
                document.getElementById("purchaseDetails").style.display =
                    "none";

                try {
                    const response = await axios.get("api/purchases.php", {
                        headers: {
                            Authorization: `Bearer ${token}`,
                        },
                    });

                    if (response.data.status === "success") {
                        purchaseData = response.data.purchases;
                        renderPurchaseTable();
                    } else {
                        throw new Error(response.data.message);
                    }
                } catch (error) {
                    handleApiError(error, "fetchPurchaseData");
                }
            }

            // แสดงตารางประวัติการซื้อ
            function renderPurchaseTable() {
                const tbody = document.getElementById("purchasesTableBody");
                tbody.innerHTML = "";

                purchaseData.forEach((purchase) => {
                    const row = document.createElement("tr");

                    // สร้าง badge ตามสถานะ
                    let statusClass = "";
                    let statusText = "";

                    switch (purchase.status) {
                        case "completed":
                            statusClass = "status-completed";
                            statusText = "สำเร็จ";
                            break;
                        case "pending":
                            statusClass = "status-pending";
                            statusText = "รอดำเนินการ";
                            break;
                        case "cancelled":
                            statusClass = "status-cancelled";
                            statusText = "ยกเลิก";
                            break;
                        default:
                            statusClass = "status-pending";
                            statusText = "รอดำเนินการ";
                    }

                    row.innerHTML = `
                    <td>${purchase.id}</td>
                    <td>${purchase.date}</td>
                    <td>${purchase.items} รายการ</td>
                    <td>฿${purchase.total.toLocaleString()}</td>
                    <td>${purchase.payment_method}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="showPurchaseDetails('${
                            purchase.id
                        }')">
                            <i class="fas fa-eye"></i> ดูรายละเอียด
                        </button>
                    </td>
                `;
                    tbody.appendChild(row);
                });

                // ซ่อน loading และแสดงตาราง
                document.getElementById("purchasesLoading").style.display =
                    "none";
                document.getElementById("purchasesContent").style.display =
                    "block";
            }

            // แสดงรายละเอียดการซื้อ
            function showPurchaseDetails(orderId) {
                const purchase = purchaseData.find((p) => p.id === orderId);
                if (!purchase) return;

                document.getElementById("orderId").textContent = purchase.id;
                document.getElementById("orderDate").textContent =
                    purchase.date;
                document.getElementById("orderTotal").textContent =
                    "฿" + purchase.total.toLocaleString();
                document.getElementById("orderPayment").textContent =
                    purchase.payment_method;

                // สถานะ
                let statusText = "";
                switch (purchase.status) {
                    case "completed":
                        statusText = "สำเร็จ";
                        break;
                    case "pending":
                        statusText = "รอดำเนินการ";
                        break;
                    case "cancelled":
                        statusText = "ยกเลิก";
                        break;
                    default:
                        statusText = "รอดำเนินการ";
                }
                document.getElementById("orderStatus").textContent = statusText;

                // รายการสินค้า
                const itemsBody = document.getElementById("orderItemsBody");
                itemsBody.innerHTML = "";

                purchase.items_detail.forEach((item) => {
                    const row = document.createElement("tr");
                    row.innerHTML = `
                    <td>${item.name}</td>
                    <td>฿${item.price.toLocaleString()}</td>
                    <td>${item.quantity}</td>
                    <td>฿${(item.price * item.quantity).toLocaleString()}</td>
                `;
                    itemsBody.appendChild(row);
                });

                // แสดงส่วนรายละเอียด
                document.getElementById("purchaseDetails").style.display =
                    "block";

                // เลื่อนไปยังส่วนรายละเอียด
                document.getElementById("purchaseDetails").scrollIntoView({
                    behavior: "smooth",
                });
            }

            // ออกจากระบบ
            function logout() {
                Swal.fire({
                    title: "ออกจากระบบ?",
                    text: "คุณแน่ใจว่าต้องการออกจากระบบหรือไม่?",
                    icon: "question",
                    showCancelButton: true,
                    confirmButtonColor: "#3498db",
                    cancelButtonColor: "#6c757d",
                    confirmButtonText: "ออกจากระบบ",
                    cancelButtonText: "ยกเลิก",
                }).then((result) => {
                    if (result.isConfirmed) {
                        // ลบ token
                        localStorage.removeItem("jwtToken");
                        // ไปหน้า login
                        window.location.href = "login.html";
                    }
                });
            }

            // จัดการข้อผิดพลาด API
            function handleApiError(error, context) {
                console.error(`เกิดข้อผิดพลาดใน ${context}:`, error);

                let errorMessage = "เกิดข้อผิดพลาดในการดำเนินการ";
                let redirectToLogin = false;

                if (error.response) {
                    // ข้อผิดพลาดจากเซิร์ฟเวอร์
                    if (error.response.status === 401) {
                        errorMessage = "Token ไม่ถูกต้องหรือหมดอายุ";
                        redirectToLogin = true;
                    } else if (
                        error.response.data &&
                        error.response.data.message
                    ) {
                        errorMessage = error.response.data.message;
                    }
                } else if (error.request) {
                    errorMessage = "ไม่มีการตอบกลับจากเซิร์ฟเวอร์";
                } else {
                    errorMessage = error.message;
                }

                showError("ข้อผิดพลาด", errorMessage);

                if (redirectToLogin) {
                    // ลบ token ที่หมดอายุ
                    localStorage.removeItem("jwtToken");
                    // กลับไปหน้า login หลังจาก delay
                    setTimeout(() => {
                        window.location.href = "login.html";
                    }, 3000);
                }
            }

            // แสดงข้อผิดพลาด
            function showError(title, message) {
                Swal.fire({
                    icon: "error",
                    title: title,
                    text: message,
                    confirmButtonColor: "#e74c3c",
                });
            }

            // แสดงข้อผิดพลาดและ redirect
            function showErrorAndRedirect(title, message) {
                Swal.fire({
                    icon: "error",
                    title: title,
                    text: message,
                    confirmButtonColor: "#e74c3c",
                }).then(() => {
                    window.location.href = "login.html";
                });
            }
        </script>
    </body>
</html>
