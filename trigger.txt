CREATE TRIGGER `After Create Group` AFTER INSERT ON `groupname`
 FOR EACH ROW 
 BEGIN
    SET @groupId = NEW.groupId;
    SET @groupname = NEW.groupname;
    SET @updatedAt = NEW.updatedAt;
    SET @rowData = JSON_OBJECT('groupId', @groupId,
  'groupname', @groupname,'updatedAt', @updatedAt);
	INSERT INTO data_changes(table_name, record_id, action, changed_at, data_after)
    VALUES ('groupnames', NEW.groupId, "CREATE", NOW(), @rowData);
END

CREATE TRIGGER `After Delete Group` AFTER DELETE ON `groupname`
 FOR EACH ROW 
 BEGIN
    INSERT INTO data_changes(table_name, record_id, action, 	changed_at)
    VALUES ('groupnames', OLD.groupId, "DELETE", NOW());
    
    UPDATE usercar SET groupname = "" WHERE groupname = OLD.groupname;
END

CREATE TRIGGER `After Update Group` AFTER UPDATE ON `groupname`
 FOR EACH ROW
 BEGIN
    SET @groupId_old = OLD.groupId;
    SET @groupId = NEW.groupId;
    SET @groupname = NEW.groupname;
    SET @updatedAt = NEW.updatedAt;
    SET @rowData = JSON_OBJECT('groupId', @groupId,
  'groupname', @groupname,'updatedAt', @updatedAt);
	INSERT INTO data_changes(table_name, record_id, action, changed_at, data_after)
    VALUES ('groupnames', OLD.groupId, "UPDATE", NOW(), @rowData);
    
    UPDATE usercar SET groupname = NEW.groupname WHERE groupname = OLD.groupname;
    
END
